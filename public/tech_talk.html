<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="icon" href="gceblogo.png" type="image/x-icon">
    <title>Tech Talks 2.0</title>
    <link rel="stylesheet" href="tech_talk.css">
</head>
<body>
    <header>
        <div class="logo">Phantasm'25</div>
        <div class="hamburger" id="hamburger" onclick="toggleMenu()">
            <div></div>
            <div></div>
            <div></div>
        </div>
        <div class="close-icon" id="closeIcon" onclick="toggleMenu()">&#x2715;</div>
        <nav>
            <a href="index.html">Home</a>
            <a href="events.html">Events</a>
            <a href="schedule.html">Schedule</a>
            <a href="contact-us.html">Contact</a>
<a href="#" id="profileLinkDesktop">Profile</a>
            <a href="login.html">Login</a>
        </nav>
        <div class="side-menu" id="sideMenu">
            <!-- Example folder-based links -->
            <a href="index.html">Home</a>
            <a href="events.html">Events</a>
            <a href="schedule.html">Schedule</a>
            <a href="contact-us.html">Contact</a>
<a href="#" id="profileLinkMobile">Profile</a>
            <a href="login.html">Login</a>
        </div>
    </header>
    <div class="container">
 
        <div class="content">
            <div class="event-title">Tech Talks 2.0</div>
            <div class="warning-message">Note: Kindly refer the schedule before registering events</div>
            <div class="event-section">
                <div class="box description-box">
                    <div class="ed">
                        <div class="front">DESCRIPTION</div>
                        <div class="back">
                            <p>
                                The event consists of two rounds:
                                Abstract Submission ‚Äì Participants submit an abstract of their paper based on the theme "Innovation in Emerging Cutting-Edge Technologies." Selected abstracts move to the next round.
                                Paper Presentation ‚Äì Shortlisted participants present their research(project) and ideas before a panel of judges. Evaluation is based on originality, technical depth, presentation skills, and innovation.</p>
                        </div>
                    </div>
                </div>
                <div class="box rules-box">
                    <div class="ed">
                        <div class="front">RULES</div>
                        <div class="back"><ol>
                            <li>üë• Participation: Individual or Team (Max 3 Members) </li>
                            <li>‚è≥ Time Allocation:</li>
                            <li>üîπ Presentation Time: 5 minutes (to explain research, findings, and innovation)</li>
                            <li>üîπ Q&A Session: 2 minutes (judges and audience ask questions</li>
                        </ol> 
                        </div>
                        </div>
                </div>
            </div>

           
 <button class="register-button" onclick="registerForEvent(1)" >REGISTER NOW</button>

            </div>
        </div>
        </div>   
    </div>
   <script>
  // --- Toggle menu ---
  function toggleMenu() {
    const sideMenu = document.getElementById('sideMenu');
    const hamburger = document.getElementById('hamburger');
    const closeIcon = document.getElementById('closeIcon');
    sideMenu.classList.toggle('open');
    if (sideMenu.classList.contains('open')) {
      hamburger.style.display = 'none';
      closeIcon.style.display = 'block';
    } else {
      hamburger.style.display = 'flex';
      closeIcon.style.display = 'none';
    }
  }

  // --- Create Modal for Registration ---
  function showRegistrationModal(userId, eventId) {
    // Remove existing modal if any
    const existing = document.getElementById('registrationModal');
    if (existing) existing.remove();

    // Create modal structure
    const modal = document.createElement('div');
    modal.id = 'registrationModal';
    modal.style.position = 'fixed';
    modal.style.top = '0';
    modal.style.left = '0';
    modal.style.width = '100%';
    modal.style.height = '100%';
    modal.style.background = 'rgba(0,0,0,0.6)';
    modal.style.display = 'flex';
    modal.style.justifyContent = 'center';
    modal.style.alignItems = 'center';
    modal.style.zIndex = '9999';

    modal.innerHTML = `
      <div style="background:#fff; padding:25px 30px; border-radius:15px; text-align:center; width:320px; box-shadow:0 4px 15px rgba(0,0,0,0.3); font-family: 'Poppins', sans-serif;">
        <h2 style="margin-bottom:15px; color:#333;">Event Registration</h2>
        <p style="margin-bottom:10px; font-weight:500;">Your User ID:</p>
        <input type="text" id="userIdField" value="PSM_${userId}" readonly style="width:90%; padding:10px; margin-bottom:15px; border-radius:8px; border:1px solid #ccc; text-align:center; background:#f5f5f5; font-weight:bold; color:#555;">
        
        <p style="margin-bottom:10px; font-weight:500;">Enter Teammate ID (0 if solo):</p>
        <input type="text" id="teammateIdField" placeholder="e.g., PSM_1023 or 0" style="width:90%; padding:10px; margin-bottom:20px; border-radius:8px; border:1px solid #ccc; text-align:center;">

        <div style="display:flex; justify-content:space-around;">
          <button id="confirmBtn" style="background:#007bff; color:#fff; border:none; padding:10px 20px; border-radius:8px; cursor:pointer;">Confirm</button>
          <button id="cancelBtn" style="background:#ccc; border:none; padding:10px 20px; border-radius:8px; cursor:pointer;">Cancel</button>
        </div>
      </div>
    `;
    document.body.appendChild(modal);

    // Cancel closes the modal
    document.getElementById('cancelBtn').onclick = () => modal.remove();

    // Confirm registration
    document.getElementById('confirmBtn').onclick = async () => {
      const teammateInput = document.getElementById('teammateIdField').value.trim() || '0';
      const participants = [ `PSM_${userId}` ];
      if (teammateInput !== '0') participants.push(teammateInput);

      try {
        const response = await fetch("/api/events/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          body: JSON.stringify({ eventId, participants })
        });

        const result = await response.json();
        if (!response.ok) throw new Error(result.error || "Unknown error");

        alert("Event registered successfully!");
        localStorage.setItem("updateEvents", "true");
        window.location.href = "/profile.html";
      } catch (error) {
        alert(error.message || "An error occurred. Please try again.");
      } finally {
        modal.remove();
      }
    };
  }

  // --- Register Function ---
  async function registerForEvent(eventId) {
    console.log("Starting event registration...");

    try {
      const userResponse = await fetch("/api/user/check-auth", {
        method: "GET",
        credentials: "include"
      });

      if (!userResponse.ok) {
        alert("Please log in first!");
        window.location.href = "/login.html";
        return;
      }

      const userData = await userResponse.json();
      const userId = userData.userId;
      showRegistrationModal(userId, eventId);
    } catch (error) {
      console.error("Error checking auth:", error);
      alert("Please log in first!");
      window.location.href = "/login.html";
    }
  }

  // --- Profile Link Auth Check ---
  document.getElementById("profileLinkDesktop").addEventListener("click", checkAuth);
  document.getElementById("profileLinkMobile").addEventListener("click", checkAuth);

  async function checkAuth(event) {
    event.preventDefault();
    try {
      const response = await fetch("/api/user/check-auth", {
        method: "GET",
        credentials: "include"
      });

      if (response.ok) {
        window.location.href = "/profile.html";
      } else {
        alert("Login first!");
        window.location.href = "/login.html";
      }
    } catch (error) {
      console.error("Error checking authentication:", error);
      alert("Login first!");
      window.location.href = "/login.html";
    }
  }

  // --- Logo Click Redirect ---
  document.querySelector('.logo').addEventListener('click', function() {
    window.location.href = 'index.html';
  });
</script>


        
    </script>
        <footer>
            <p>&copy; 2025 CSEA. All rights reserved.</p>
        </footer>
</body>
</html>
